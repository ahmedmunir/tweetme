{% extends 'pages/base.html' %}

<!-- Home Title -->
{% block title %}
    {% if user.is_authenticated %}
        Home - {{ user }}
    {% else %}
        TweetME - Home
    {% endif %}
{% endblock title %}

{% block content %}
    <div id="tweets"></div>
{% endblock content %}

{% block extraScript %}
    <script>
        // Display loading while fetching data of tweets
        let tweetsElement = document.querySelector("#tweets");
        tweetsElement.innerHTML = "Loading..."

        // Fetch data from server
        let url = `${window.location.protocol}//${window.location.hostname}:${window.location.port}/tweets/`
        fetch(url, {
            method: "GET",
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            
            // Hide Loading shape
            tweetsElement.innerHTML = "";

            // Display tweets
            data['tweets'].forEach(tweet => {

                // Tweet Element Container
                let tweet_Element = document.createElement('div');
                tweet_Element.setAttribute('data-id', tweet['id']);
                tweet_Element.classList.add('tweet_container');

                // Tweet Text
                let tweet_text = document.createElement('p');
                tweet_text.classList.add('tweet_text');
                tweet_text.innerHTML = tweet['content'];

                // Tweet Like button
                let like_button = document.createElement('button');
                like_button.classList.add('btn');
                like_button.classList.add('btn-primary');
                like_button.innerHTML = 'Like';

                // Number of likes
                let likes_number = document.createElement('span');
                likes_number.innerHTML = '0';

                // Tweet Displike button
                let dislike_button = document.createElement('button');
                dislike_button.classList.add('btn');
                dislike_button.classList.add('btn-primary');
                dislike_button.innerHTML = 'Dislike';

                // Number of Dislikes
                let dislikes_number = document.createElement('span');
                dislikes_number.innerHTML = '0';

                // Insert All elements inside Div that will contain them
                tweet_Element.insertAdjacentElement('beforeend', tweet_text);
                tweet_Element.insertAdjacentElement('beforeend', like_button);
                tweet_Element.insertAdjacentElement('beforeend', likes_number);
                tweet_Element.insertAdjacentElement('beforeend', dislike_button);
                tweet_Element.insertAdjacentElement('beforeend', dislikes_number);
                tweetsElement.insertAdjacentElement('beforeend', tweet_Element);

            });
        })



        
    </script>

{% endblock extraScript %}